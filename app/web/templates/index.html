{% extends "base.html" %}
{% block title %}BirdFeeder - Today{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col">
        <form class="d-inline" onsubmit="return navigateToDate(event)">
            <label class="form-label fw-bold">Jump to date:</label>
            <input type="date" id="datePicker" class="form-control d-inline-block w-auto"
                   value="{{ date }}" min="{{ earliest_date }}" max="{{ date }}">
            <button type="submit" class="btn btn-primary btn-sm">Go</button>
        </form>
    </div>
</div>

<h4>Recent Detections</h4>
{% if recent_detections %}
<div class="table-responsive">
    <table class="table table-sm table-striped">
        <thead>
            <tr>
                <th>Time</th>
                <th>Species</th>
                <th>Confidence</th>
                <th>Duration</th>
                <th>Thumbnail</th>
            </tr>
        </thead>
        <tbody>
            {% for d in recent_detections %}
            <tr>
                <td>{{ d.detection_time|datetime }}</td>
                <td>{{ d.common_name }}</td>
                <td>{{ d.score|pct }}</td>
                <td>{{ "%.1f"|format(d.duration_seconds) }}s</td>
                <td>
                    {% if d.thumbnail_path %}
                    <img src="/media/{{ d.thumbnail_path }}" alt="{{ d.common_name }}"
                         class="thumb" style="cursor:pointer; max-height:60px;"
                         onclick="openMediaModal('{{ d.common_name }}',
                                  '{{ "/media/" + d.snapshot_path if d.snapshot_path else "" }}',
                                  '{{ "/media/" + d.clip_path if d.clip_path else "" }}')">
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p class="text-muted">No detections yet.</p>
{% endif %}

<hr>

<h4>Today's Summary ({{ date }})</h4>
{% if daily_summary %}
<div class="table-responsive">
    <table class="table table-sm table-bordered summary-table">
        <thead>
            <tr>
                <th>Species</th>
                <th>Total</th>
                {% for h in range(current_hour + 1) %}
                <th><a href="/detections/by_hour/{{ date }}/{{ h }}">{{ "%02d"|format(h) }}</a></th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for name, data in daily_summary.items() %}
            <tr>
                <td><a href="/detections/by_species/{{ data.scientific_name }}/{{ date }}">{{ data.common_name }}</a></td>
                <td class="fw-bold">{{ data.total }}</td>
                {% for h in range(current_hour + 1) %}
                <td>
                    {% if data.hourly[h] > 0 %}
                    <a href="/detections/by_hour/{{ date }}/{{ h }}">{{ data.hourly[h] }}</a>
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p class="text-muted">No detections today.</p>
{% endif %}

<script>
function navigateToDate(e) {
    e.preventDefault();
    const date = document.getElementById('datePicker').value;
    if (date) window.location.href = '/daily_summary/' + date;
    return false;
}
</script>
{% endblock %}
